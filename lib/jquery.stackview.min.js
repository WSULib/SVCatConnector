/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 * 
 * Open source under the BSD License. 
 * 
 * Copyright Â© 2008 George McGinley Smith
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
*/// t: current time, b: begInnIng value, c: change In value, d: duration
jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){s==undefined&&(s=1.70158);return r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){s==undefined&&(s=1.70158);return r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){s==undefined&&(s=1.70158);return(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}});(function(e,t,n,r){var i,s="stackView",o,u={};i={init:"stackview.init",item_added:"stackview.itemadded",item_removed:"stackview.itemremoved",page_load:"stackview.pageload"};var a=function(t){var n;e.each(u,function(e,r){if(r.match(t)){n=r;return!1}});return n},f=function(t,n,r){var i=r?"before":"append",s=r?r:t.$element.find(t.options.selectors.item_list);e.each(n,function(n,r){var o=a(r),u;if(o==null)return!0;u=e(tmpl(o.template,o.adapter(r,t.options)));u.data("stackviewItem",r);s[i](u)});r&&r.remove()},l=function(e){var t=e.options,n;n={start:e.page*e.options.items_per_page,limit:e.options.items_per_page,search_type:e.options.search_type,query:e.options.query};if(n.search_type==="loc_sort_order"){n.start=0;if(e.page===0){e.loc={low:t.id-Math.floor(t.items_per_page/2),high:t.id+Math.floor(t.items_per_page/2)};n.query=["[",e.loc.low,"%20TO%20",e.loc.high,"]"].join("")}else if(e.direction==="down"){n.query=["[",e.loc.high+1,"%20TO%20",e.loc.high+t.items_per_page+1,"]"].join("");e.loc.high=e.loc.high+t.items_per_page+1}else if(e.direction==="up"){n.query=["[",e.loc.low-t.items_per_page-1,"%20TO%20",e.loc.low-1,"]"].join("");e.loc.low=e.loc.low-t.items_per_page-1}}return n},c=function(n,r){var i=l(n),s=e.param(i),o;n.page++;o=t.stackCache.get(n.options.url+s);o?r(o):e.ajax({url:n.options.url,data:s,dataType:n.options.jsonp?"jsonp":"json",success:function(e){t.stackCache.set(n.options.url+i,e,n.options.cache_ttl);r(e)}})};o=function(t,n){this.element=t;this.$element=e(t);this.options=e.extend({},o.defaults,n);this.page=0;this.finished={up:!1,down:!1};this.loc={low:null,high:null};this.direction="down";this.init()};e.extend(!0,o,{defaults:{cache_ttl:60,data:"",id:null,items_per_page:10,jsonp:!1,query:"",ribbon:"Stack View",search_type:"keyword",selectors:{item:".stack-item",item_list:".stack-items",ribbon:".ribbon"},url:"basic.json"},utils:{get_heat:function(e){return e===100?10:Math.floor(e/10)+1}},register_type:function(e){u[e.name]=e},get_types:function(){return u}});e.extend(!0,o.prototype,{init:function(){var e=this;this.$element.html(tmpl(o.templates.scaffold,{ribbon:this.options.ribbon})).addClass("stackview").bind(i.page_load,function(){e.zIndex()});this.$element.data("stackviewObject",this);this.$element.trigger(i.init);this.next_page()},next_page:function(){var t=e(tmpl(o.templates.placeholder,{})),n=this,r=this.options;if(this.finished.down)return;this.direction="down";if(r.data){f(this,r.data.docs?r.data.docs:r.data);this.finished.down=!0;this.$element.trigger(i.page_load,[r.data])}else if(r.url){this.$element.find(r.selectors.item_list).append(t);c(this,function(e){f(n,e.docs,t);parseInt(e.start,10)===-1&&(n.finished.down=!0);n.$element.trigger(i.page_load,[e])})}},prev_page:function(){var t=e(tmpl(o.templates.placeholder,{})),n=this.options,r=this,s=r.$element.find(n.selectors.item).first();if(n.search_type!=="loc_sort_order"||this.finished.up)return;this.direction="up";this.$element.find(n.selectors.item_list).prepend(t);c(this,function(e){var o=s.position().top;f(r,e.docs,t);r.page>1&&r.$element.find(n.selectors.item_list).animate({scrollTop:"+="+(s.position().top-o)},0);parseInt(e.start,10)===-1&&(r.finished.up=!0);r.$element.trigger(i.page_load,[e])})},add:function(){var t=this.$element.find(this.options.selectors.item),n,r,s,o,u,f;if(typeof arguments[0]=="number"){n=arguments[0];r=arguments[1]}else{n=t.length;r=arguments[0]}if(n>t.length||n<0)return;if(n===t.length){u=t.last();o="after"}else{u=t.eq(n);o="before"}s=a(r);if(s==null)return;f=e(tmpl(s.template,s.adapter(r,this.options)));f.data("stackviewItem",r);u[o](f);this.zIndex();this.$element.trigger(i.item_added)},remove:function(t){var n=this.$element.find(this.options.selectors.item),r,s,o;typeof t=="number"?r=n.eq(t):t.nodeType||t.jquery?r=e(t):n.each(function(n,i){var s=e(i);if(s.data("stackviewItem")===t){r=s;return!1}});if(r==null||!r.length)return;r.detach();s=r.data("stackviewItem");this.$element.trigger(i.item_removed,[s]);return r},getData:function(){var t=[];this.$element.find(this.options.selectors.item).each(function(){t.push(e(this).data("stackviewItem"))});return t},zIndex:function(e){var t=this.$element.find(this.options.selectors.item),n=t.length,r=0,i=e?0:t.length-1;while(r<n){t.eq(r).css("z-index",i);i+=e?1:-1;r++}}});e.fn[s]=function(t){var n,i=Array.prototype.slice.call(arguments,1);this.each(function(s,u){var a=e(u),f=a.data("stackviewObject");if(!f)new o(u,t);else if(f[t]){var l=f[t].apply(f,i);n===r&&l!==r&&(n=l)}});return n===r?this:n};t.StackView=o})(jQuery,window,document);(function(e,t){var n=e(document),r;e.extend(StackView.defaults,{infiniteScrollDistance:100});r=function(t){var n=e(t.target),r=n.data("stackviewObject"),i=r.options,s,o,i,u,a,f;s=n.find(i.selectors.item_list);o=n.find(i.selectors.item);u=o.length?o.last().position().top:0;u+=s.scrollTop();a=u-n.height()-i.infiniteScrollDistance;f=function(){if(i.search_type==="loc_sort_order"&&s.scrollTop()<=i.infiniteScrollDistance){s.unbind("scroll.stackview");n.stackView("prev_page")}else if(s.scrollTop()>=a){s.unbind("scroll.stackview");n.stackView("next_page")}};s.bind("scroll.stackview",f);f()};n.delegate(".stackview","stackview.pageload",r)})(jQuery);(function(e,t){var n=e(document),r=window.StackView;e.extend(!0,r.defaults,{classes:{ministack:"stackview-mini"},ministack:{breakpoint:220,max_height_percentage:100,min_height_percentage:80,page_multiple:.08}});n.delegate(".stackview","stackview.init",function(t){var n=e(t.target),r=n.data("stackviewObject");if(n.width()<=r.options.ministack.breakpoint){n.addClass(r.options.classes.ministack);e.each(["max_height_percentage","min_height_percentage","page_multiple"],function(e,t){r.options.book[t]=r.options.ministack[t]})}})})(jQuery);(function(e,t){var n=e(document),r=window.StackView;e.extend(!0,r.defaults,{transitionDuration:500,transitionEasing:"easeOutQuad",navigationPercent:80,selectors:{downstream:".downstream",upstream:".upstream",num_items:".num-found span"}});n.delegate(".stackview","stackview.init",function(t){var n=e(t.target),i=n.data("stackviewObject"),s=n.find(i.options.selectors.item_list),o=n.height()*i.options.navigationPercent/100;i.num_found_delta=0;n.prepend(tmpl(r.templates.navigation,{empty:i.options.search_type==="loc_sort_order"}));n.delegate(i.options.selectors.downstream,"click",function(){s.animate({scrollTop:"+="+o},i.options.transitionDuration,i.options.transitionEasing);return!1}).delegate(i.options.selectors.upstream,"click",function(){s.animate({scrollTop:"-="+o},i.options.transitionDuration,i.options.transitionEasing);return!1})}).delegate(".stackview","stackview.pageload",function(t,n){var r=e(t.target),i=r.data("stackviewObject"),s=n.num_found?parseInt(n.num_found,10):n.length,o;i.num_found=s;o=s+i.num_found_delta;r.find(i.options.selectors.num_items).text(o)}).delegate(".stackview","stackview.itemadded stackview.itemremoved",function(t){var n=e(t.target),r=n.data("stackviewObject"),i=n.find(r.options.selectors.item),s;r.num_found_delta+=t.namespace==="itemadded"?1:-1;s=r.num_found+r.num_found_delta;n.find(r.options.selectors.num_items).text(s)})})(jQuery);window.stackCache=function(e,t){function i(e,t,i){var s=i&&new Date(+(new Date)+i*1e3),o={expires:+s,value:t};if(r)try{localStorage[e]=JSON.stringify(o)}catch(u){return u}else n[e]=o}function s(e){var t,i;if(r){t=localStorage[e];t&&(t=JSON.parse(t))}else t=n[e];t&&(t.expires&&t.expires<+(new Date)?o(e):i=t.value);return i}function o(e){r?localStorage.removeItem(e):delete n[e]}var n={},r=e.JSON&&function(){try{return"localStorage"in e&&e.localStorage!==null}catch(t){return!1}}();return{set:i,get:s,remove:o}}(window);(function(e){StackView.templates={scaffold:'			<ul class="stack-items" />',navigation:'			<div class="stack-navigation<%= empty ? " empty" : ""%>">				<div class="upstream">Up</div>				<div class="num-found">					<span></span><br />items				</div>				<div class="downstream">Down</div>			</div>',book:'			<li class="stack-item stack-book heat<%= heat %>" style="width:<%= book_height %>; height:<%= book_thickness %>;" title="<%= title %>">				<a href="<%= link %>">					<span class="spine-text">						<span class="spine-title"><%= title %></span>					</span>					<span class="spine-year"><%= year %></span>					<span class="stack-pages" />					<span class="stack-cover" />					<!--<span class="spine-author"><%= author %></span>-->				</a>			</li>',placeholder:'<li class="stackview-placeholder"></li>'}})();(function(){var e={};this.tmpl=function t(n,r){var i=/\W/.test(n)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');"):e[n]=e[n]||t(document.getElementById(n).innerHTML);return r?i(r):i}})();(function(e,t,n){e.extend(!0,t.StackView.defaults,{book:{max_height_percentage:100,max_height:39,max_pages:540,min_height_percentage:59,min_height:20,min_pages:200,page_multiple:.2},selectors:{book:".stack-book"}});var r=function(e,t,n,r,i){var s=n-t,o=i-r,u=(e-t)/s;return r+u*o},i=function(e,t){var n=parseInt(t.measurement_height_numeric,10),i=e.book.min_height,s=e.book.max_height;isNaN(n)&&(n=i);n=Math.min(Math.max(n,i),s);n=r(n,e.book.min_height,e.book.max_height,e.book.min_height_percentage,e.book.max_height_percentage);return n+"%"},s=function(e,t){var n=parseInt(t.measurement_page_numeric,10),r=e.book.min_pages,i=e.book.max_pages,s=e.book.page_multiple;isNaN(n)&&(n=r);n=Math.min(Math.max(n,r),i)*s;return n+"px"},o=function(e){return e.title_link_friendly?"../shelflife/book/"+e.title_link_friendly+"/"+e.id:e.link},u=function(e){var t=e.creator&&e.creator.length?e.creator[0]:"";/^([^,]*)/.test(t)&&(t=t.match(/^[^,]*/));return t};t.StackView.register_type({name:"book",match:function(e){return e.format&&e.format==="book"||!e.format},adapter:function(e,n){return{heat:t.StackView.utils.get_heat(e.shelfrank),book_height:i(n,e),book_thickness:s(n,e),link:o(e),title:e.title,author:u(e),year:e.pub_date}},template:'			<li class="stack-item stack-book heat<%= heat %>" style="width:<%= book_height %>; height:<%= book_thickness %>;" title="<%= title %>">				<a href="<%= link %>">					<span class="spine-text">						<span class="spine-title"><%= title %></span>						<!--<span class="spine-author"><%= author %></span>-->					</span>					<span class="spine-year"><%= year %></span>					<span class="stack-pages" />					<span class="stack-cover" />				</a>			</li>'})})(jQuery,window);(function(e,t,n){e.extend(!0,t.StackView.defaults,{selectors:{serial:".stack-serial"}});t.StackView.register_type({name:"serial",match:function(e){return e.format==="Serial"},adapter:function(e,n){return{heat:t.StackView.utils.get_heat(e.shelfrank),title:e.title,link:e.link}},template:'			<li class="stack-item stack-serial heat<%= heat %>">				<a href="<%= link %>">					<span class="spine-text">						<span class="spine-title"><%= title %></span>					</span>					<span class="serial-edge" />					<span class="serial-cover" />				</a>			</li>'})})(jQuery,window);(function(e,t,n){e.extend(!0,t.StackView.defaults,{selectors:{soundrecording:".stack-soundrecording"}});t.StackView.register_type({name:"soundrecording",match:function(e){return e.format==="Sound Recording"},adapter:function(e,n){return{heat:t.StackView.utils.get_heat(e.shelfrank),link:"#",title:e.title,year:e.pub_date}},template:'			<li class="stack-item stack-soundrecording heat<%= heat %>">				<a href="<%= link %>">						<span class="spine-text">							<span class="spine-title"><%= title %></span>						</span>						<span class="spine-year"><%= year %></span>						<span class="sound-edge"></span>						<span class="sound-cover"></span>				</a>			</li>'})})(jQuery,window);(function(e,t,n){e.extend(!0,t.StackView.defaults,{selectors:{videofilm:".stack-videofilm"}});var r=function(e){return e.title?e.title:"#"};t.StackView.register_type({name:"videofilm",match:function(e){return e.format==="Video/Film"},adapter:function(e,n){return{heat:t.StackView.utils.get_heat(e.shelfrank),height:"65%",title:e.title,year:e.pub_date,link:r(e)}},template:'			<li class="stack-item stack-videofilm heat<%= heat %>" style="width:<%= height %>;">				<a href="<%= link %>">					<span class="spine-text">						<span class="spine-title"><%= title %></span>					</span>					<span class="spine-year"><%= year %></span>					<span class="videofilm-edge" />					<span class="videofilm-cover" />				</a>			</li>'})})(jQuery,window);(function(e,t,n){e.extend(!0,t.StackView.defaults,{selectors:{webpage:".stack-webpage"}});t.StackView.register_type({name:"webpage",match:function(e){return e.format==="webpage"},adapter:function(e,n){return{heat:t.StackView.utils.get_heat(e.shelfrank),link:e.rsrc_value,publisher:e.publisher,title:e.title}},template:'			<li class="stack-item stack-webpage heat<%= heat %>">				<a href="<%= link %>">					<span class="url-bar">						<span class="url-publisher"><%= publisher %>:</span>						<span class="url-title"><%= title %></span>					</span>					<span class="webpage-top"></span>					<span class="webpage-edge"></span>				</a>			</li>'})})(jQuery,window);